https://www.jianshu.com/p/e8084a60fe88


1 MySQL高可用集群搭建(pxc)
01 拉取pxc镜像
    docker pull percona/percona-xtradb-cluster

02 复制pxc镜像(实则重命名)
    docker tag percona/percona-xtradb-cluster:latest pxc-cluster

03 删除pxc原来的镜像
    docker rmi percona/percona-xtradb-cluster:latest

04 创建一个单独的网段，给mysql数据库集群使用
    (1)docker network create --subnet=172.18.0.0/24 pxc-net
    (2)docket network inspect pxc-net   [查看详情]
    (3)docker network rm pxc-net        [删除]

05 创建和删除volume
    创建：docker volume create --name pxc-v1 => "Mountpoint": "/var/lib/docker/volumes/pxc-v1/_data"
    创建：docker volume create --name pxc-v2 => "Mountpoint": "/var/lib/docker/volumes/pxc-v2/_data"
    创建：docker volume create --name pxc-v3 => "Mountpoint": "/var/lib/docker/volumes/pxc-v3/_data"
    创建：docker volume create --name pxc-v4 => "Mountpoint": "/var/lib/docker/volumes/pxc-v4/_data"
    删除：docker volume rm v1
    查看详情：docker inspect pxc-v1

06 创建单个PXC容器
[CLUSTER_NAME PXC集群名字]
[XTRABACKUP_PASSWORD数据库同步需要用到的密码]
[如果需要ace-net网络内指定ip, 可以在--net=ace-net --ip xxx.xxx.xxx.xxx]

docker run -d -p 3311:3306 \
-v pxc-v1:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=root \
-e CLUSTER_NAME=PXC \
-e XTRABACKUP_PASSWORD=root \
--privileged --name=pxc-node1 \
--net=ace-net \
pxc-cluster:latest



07 搭建PXC[MySQL]集群
    (1)准备3个数据卷
docker volume create --name pxc-v1
docker volume create --name pxc-v2
docker volume create --name pxc-v3
docker volume create --name pxc-v4
    (2)运行三个PXC容器
        [在创建完第一个node1，需要等待一段时间，大概1分钟左右，等node1启动初始化完成，才能创建node2和node3，不然会出错，大家一定要注意]
        [如果需要ace-net网络内指定ip, 可以在--net=ace-net --ip xxx.xxx.xxx.xxx]
Master
docker run -d -p 3311:3306 \
-v pxc-v1:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=root \
-e CLUSTER_NAME=PXC \
-e XTRABACKUP_PASSWORD=root \
--privileged --name=pxc-node1 \
--net=ace-net \
pxc-cluster:latest

        [CLUSTER_JOIN将该数据库加入到节点上组成集群]
docker run -d -p 3312:3306 \
-v pxc-v2:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=root \
-e CLUSTER_NAME=PXC \
-e XTRABACKUP_PASSWORD=root \
-e CLUSTER_JOIN=pxc-node1 \
--privileged --name=pxc-node2 \
--net=ace-net \
pxc-cluster:latest

docker run -d -p 3313:3306 \
-v pxc-v3:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=root \
-e CLUSTER_NAME=PXC \
-e XTRABACKUP_PASSWORD=root \
-e CLUSTER_JOIN=pxc-node1 \
--privileged --name=pxc-node3 \
--net=ace-net \
pxc-cluster:latest

docker run -d -p 3314:3306 \
-v pxc-v4:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=root \
-e CLUSTER_NAME=PXC \
-e XTRABACKUP_PASSWORD=root \
-e CLUSTER_JOIN=pxc-node1 \
--privileged --name=pxc-node4 \
--net=ace-net \
pxc-cluster:latest

    (3)MySQL工具连接测试
        Jetbrains Datagrip

